<%
  const active = 'tokens';
  const body = `
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Page Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900">JWT Tokens</h1>
      <p class="mt-2 text-sm text-gray-600">View and inspect your authentication tokens</p>
    </div>

    <!-- ID Token (First) -->
    ${tokens.id_token ? `
    <div class="bg-white shadow-sm rounded-lg mb-6">
      <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
        <div>
          <h2 class="text-lg font-medium text-gray-900 flex items-center">
            <svg class="h-5 w-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2"></path>
            </svg>
            ID Token
          </h2>
          ${expiration.id_token ? `
          <p class="text-sm ${expiration.id_token.expired ? 'text-red-600' : 'text-green-600'}">
            ${expiration.id_token.expired ? 'Expired' : 'Valid'} | Expires: ${expiration.id_token.date}
            ${!expiration.id_token.expired ? '(' + Math.floor(expiration.id_token.remaining / 60) + ' min remaining)' : ''}
          </p>
          ` : ''}
        </div>
        <button onclick="copyToClipboard('id_token')" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
          <svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
          </svg>
          Copy
        </button>
      </div>

      <div class="p-6 space-y-4">
        <!-- Raw Token -->
        <div>
          <h3 class="text-sm font-medium text-gray-700 mb-2">Raw Token</h3>
          <div class="bg-gray-50 rounded-md p-3 border border-gray-200">
            <code id="id_token" class="text-xs text-gray-800 break-all font-mono">${tokens.id_token}</code>
          </div>
        </div>

        ${decoded.id_token ? `
        <!-- Header -->
        <div>
          <h3 class="text-sm font-medium text-gray-700 mb-2">Header</h3>
          <div class="bg-gray-50 rounded-md p-3 border border-gray-200">
            <pre class="text-xs text-gray-800 overflow-auto"><code>${JSON.stringify(decoded.id_token.header, null, 2)}</code></pre>
          </div>
        </div>

        <!-- Payload -->
        <div>
          <h3 class="text-sm font-medium text-gray-700 mb-2">Payload (Claims)</h3>
          <div class="bg-gray-50 rounded-md p-3 border border-gray-200">
            <pre class="text-xs text-gray-800 overflow-auto"><code>${JSON.stringify(decoded.id_token.payload, null, 2)}</code></pre>
          </div>
        </div>
        ` : ''}
      </div>
    </div>
    ` : ''}

    <!-- Access Token (Second) -->
    ${tokens.access_token ? `
    <div class="bg-white shadow-sm rounded-lg mb-6">
      <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
        <div>
          <h2 class="text-lg font-medium text-gray-900 flex items-center">
            <svg class="h-5 w-5 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
            </svg>
            Access Token
          </h2>
          ${expiration.access_token ? `
          <p class="text-sm ${expiration.access_token.expired ? 'text-red-600' : 'text-green-600'}">
            ${expiration.access_token.expired ? 'Expired' : 'Valid'} | Expires: ${expiration.access_token.date}
            ${!expiration.access_token.expired ? '(' + Math.floor(expiration.access_token.remaining / 60) + ' min remaining)' : ''}
          </p>
          ` : ''}
        </div>
        <button onclick="copyToClipboard('access_token')" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
          <svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
          </svg>
          Copy
        </button>
      </div>

      <div class="p-6 space-y-4">
        <!-- Raw Token -->
        <div>
          <h3 class="text-sm font-medium text-gray-700 mb-2">Raw Token</h3>
          <div class="bg-gray-50 rounded-md p-3 border border-gray-200">
            <code id="access_token" class="text-xs text-gray-800 break-all font-mono">${tokens.access_token}</code>
          </div>
        </div>

        ${decoded.access_token ? `
        <!-- Header -->
        <div>
          <h3 class="text-sm font-medium text-gray-700 mb-2">Header</h3>
          <div class="bg-gray-50 rounded-md p-3 border border-gray-200">
            <pre class="text-xs text-gray-800 overflow-auto"><code>${JSON.stringify(decoded.access_token.header, null, 2)}</code></pre>
          </div>
        </div>

        <!-- Payload -->
        <div>
          <h3 class="text-sm font-medium text-gray-700 mb-2">Payload (Claims)</h3>
          <div class="bg-gray-50 rounded-md p-3 border border-gray-200">
            <pre class="text-xs text-gray-800 overflow-auto"><code>${JSON.stringify(decoded.access_token.payload, null, 2)}</code></pre>
          </div>
        </div>
        ` : ''}
      </div>
    </div>
    ` : ''}

    <!-- Refresh Token (Third) -->
    ${tokens.refresh_token ? `
    <div class="bg-white shadow-sm rounded-lg mb-6">
      <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
        <div>
          <h2 class="text-lg font-medium text-gray-900 flex items-center">
            <svg class="h-5 w-5 text-purple-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            Refresh Token
          </h2>
        </div>
        <button onclick="copyToClipboard('refresh_token')" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
          <svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
          </svg>
          Copy
        </button>
      </div>

      <div class="p-6 space-y-4">
        <!-- Raw Token -->
        <div>
          <h3 class="text-sm font-medium text-gray-700 mb-2">Raw Token</h3>
          <div class="bg-gray-50 rounded-md p-3 border border-gray-200">
            <code id="refresh_token" class="text-xs text-gray-800 break-all font-mono">${tokens.refresh_token}</code>
          </div>
        </div>
      </div>
    </div>
    ` : ''}

    ${!tokens.access_token && !tokens.id_token ? `
    <div class="bg-white shadow-sm rounded-lg p-12 text-center">
      <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
      </svg>
      <h3 class="mt-2 text-sm font-medium text-gray-900">No tokens available</h3>
      <p class="mt-1 text-sm text-gray-500">Please log in to view your tokens.</p>
    </div>
    ` : ''}

    <!-- Info Box -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-6">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-blue-800">About JWT Tokens</h3>
          <div class="mt-2 text-sm text-blue-700">
            <ul class="list-disc pl-5 space-y-1">
              <li><strong>ID Token:</strong> Contains user identity information and authentication details</li>
              <li><strong>Access Token:</strong> Used to authenticate API requests to protected resources</li>
              <li><strong>Refresh Token:</strong> Used to obtain new access tokens when they expire</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function copyToClipboard(elementId) {
      const element = document.getElementById(elementId);
      const text = element.textContent;

      navigator.clipboard.writeText(text).then(() => {
        // Show success feedback
        const button = event.target.closest('button');
        const originalHTML = button.innerHTML;
        button.innerHTML = '<svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Copied!';
        button.classList.add('bg-green-50', 'border-green-300', 'text-green-700');

        setTimeout(() => {
          button.innerHTML = originalHTML;
          button.classList.remove('bg-green-50', 'border-green-300', 'text-green-700');
        }, 2000);
      }).catch(err => {
        console.error('Failed to copy:', err);
      });
    }
  </script>
  `;
%>
<%- include('layouts/main', { title, user, isAuthenticated, active, body }) %>
